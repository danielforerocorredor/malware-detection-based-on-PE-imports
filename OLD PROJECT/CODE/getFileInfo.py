import hashlib
import os 
import math
import pefile

import ML_for_headers as ML
import ML_for_imports as ML2

def calcEntropy(fileLoc):
    with open(fileLoc, 'rb') as f:
        byteArr = list(f.read())
    fileSize = len(byteArr)
    freqList = []
    for b in range(256):
        ctr = 0
        for byte in byteArr:
            if byte == b:
                ctr += 1
        freqList.append(float(ctr) / fileSize)
    ent = 0.0
    for freq in freqList:
        if freq > 0:
            ent = ent + freq * math.log(freq, 2)
    ent = -ent
    return ent

def getHeadersInfo(fileLoc):
    virtualSize = 0 
    VirutalAddress = 0
    #get hash

    h = hashlib.new("md5")
    with open(fileLoc ,"rb") as f:
        h.update(f.read())

    hash = h.hexdigest()

    #get size in bytes 

    fileStats = os.stat(fileLoc)
    size = fileStats.st_size

    #get virtual size and virtual address 

    pe = pefile.PE(fileLoc)

    for section in pe.sections:
        if(section.Name.decode().rstrip('\x00')==".text"):
            virtualSize = section.Misc_VirtualSize
            VirutalAddress = section.VirtualAddress


    #get entropy

    entropy = calcEntropy(fileLoc)

    #results
    res = [size, entropy, virtualSize]
    stringFinal = str(size)+','+str(entropy)+','+str(virtualSize)


    return res

def getImports(fileLoc):
    h = hashlib.new("md5")
    with open(fileLoc ,"rb") as f:
        h.update(f.read())

    hash = h.hexdigest()

    allImports = ['GetProcAddress', 'ExitProcess', 'WriteFile', 'GetLastError', 'CloseHandle', 'FreeLibrary', 'Sleep', 'GetStdHandle', 'MultiByteToWideChar', 'GetCurrentThreadId', 'FindClose', 'LeaveCriticalSection', 'EnterCriticalSection', 'VirtualAlloc', 'DeleteCriticalSection', 'WideCharToMultiByte', 'RegCloseKey', 'ReadFile', 'SetFilePointer', 'GetCurrentProcess', 'GetACP', 'UnhandledExceptionFilter', 'RaiseException', 'RtlUnwind', 'TlsGetValue', 'TlsSetValue', 'GetModuleHandleW', 'GetCPInfo', 'GetCurrentProcessId', 'VirtualFree', 'GetDC', 'GetModuleFileNameW', 'CreateFileW', 'SetEndOfFile', 'SetLastError', 'GetCommandLineW', 'DestroyWindow', 'QueryPerformanceCounter', 'VirtualQuery', 'ShowWindow', 'GetFileType', 'TerminateProcess', 'HeapFree', 'HeapAlloc', 'CreateThread', 'BeginPaint', 'EndPaint', 'GlobalAlloc', 'GetModuleHandleA', 'GetCommandLineA', 'GetWindowRect', 'DeleteObject', 'SetWindowPos', 'GetClientRect', 'SelectObject', 'LoadLibraryExW', 'GlobalLock', 'GlobalUnlock', 'GetSystemMetrics', 'IsWindow', 'GetSysColor', 'GetDeviceCaps', 'MulDiv', 'IsDebuggerPresent', 'InvalidateRect', 'SetTimer', 'LoadLibraryA', 'IsWindowVisible', 'HeapSize', 'GetStartupInfoW', 'GetFileSize', 'TranslateMessage', 'FillRect', 'VariantInit', 'SetForegroundWindow', 'SysFreeString', 'LoadResource', 'ReleaseDC', 'SizeofResource', 'GetSystemInfo', 'SetEvent', 'LocalFree', 'ScreenToClient', 'VirtualProtect', 'ResetEvent', 'GetTickCount', 'SetTextColor', 'SetBkMode', 'VariantClear', 'SetUnhandledExceptionFilter', 'CreateSolidBrush', 'LockResource', 'DeleteDC', 'GetStockObject', 'GetVersion', 'GetParent', 'SetFocus', 'GetSystemTimeAsFileTime', 'CreateCompatibleDC', 'RegOpenKeyExW', 'HeapReAlloc', 'LCMapStringW', 'RegQueryValueExW', 'UpdateWindow', 'CoCreateInstance', 'GetOEMCP', 'KillTimer', 'GetConsoleCP', 'GetWindow', 'GetEnvironmentStringsW', 'GetStringTypeW', 'GetProcessHeap', 'ClientToScreen', 'FreeEnvironmentStringsW', 'TlsAlloc', 'GetFocus', 'GetDesktopWindow', 'FlushFileBuffers', 'GetLocaleInfoW', 'TlsFree', 'GetDlgItem', 'WaitForSingleObject', 'InitializeCriticalSection', 'CreateWindowExW', 'SysAllocStringLen', 'SetStdHandle', 'IsValidCodePage', 'InitializeCriticalSectionAndSpinCount', 'LocalAlloc', 'GetConsoleMode', 'CoTaskMemFree', 'RedrawWindow', 'WriteConsoleW', 'CreateCompatibleBitmap', 'IsChild', 'OleInitialize', 'InterlockedIncrement', 'InterlockedDecrement', 'DispatchMessageW', 'GetCursorPos', 'BitBlt', 'DefWindowProcW', 'SendMessageW', 'IsProcessorFeaturePresent', 'SetWindowLongW', 'OleUninitialize', 'ReleaseCapture', 'SetCapture', 'LoadCursorW', 'CompareStringW', 'GetWindowThreadProcessId', 'CharNextW', 'FindNextFileW', 'GetModuleFileNameA', 'CreateEventW', 'GetFileAttributesW', 'RegSetValueExW', 'DecodePointer', 'CallWindowProcW', 'RegCreateKeyExW', 'EnumWindows', 'PeekMessageW', 'FindResourceW', 'GetDIBits', 'GetWindowLongW', 'SetWindowTextW', 'GetThreadLocale', 'MessageBoxW', 'IsValidLocale', 'RegDeleteValueW', 'RegDeleteKeyW', 'SetFilePointerEx', 'PostMessageW', 'EncodePointer', 'CoInitialize', 'FormatMessageW', 'GetWindowTextW', 'GetModuleHandleExW', 'SetErrorMode', 'GetUserDefaultLCID', 'GetObjectW', 'CoUninitialize', 'CreateFileA', 'GlobalFree', 'CoTaskMemAlloc', 'EnableWindow', 'PostQuitMessage', 'LoadLibraryExA', 'RegEnumKeyExW', 'GetClassNameW', 'DrawTextW', 'GetClassInfoExW', 'RegQueryInfoKeyW', 'CreateStreamOnHGlobal', 'RegisterWindowMessageW', 'RegOpenKeyExA', 'MessageBoxA', 'RegQueryValueExA', 'CreateAcceleratorTableW', 'lstrcmpW', 'SetCursor', 'CreateFontIndirectW', 'EnumSystemLocalesW', 'HeapDestroy', 'LoadBitmapW', 'SetBkColor', 'IsWindowEnabled', 'EnableMenuItem', 'CreateDirectoryW', 'InitializeSListHead', 'CreatePopupMenu', 'TrackPopupMenu', 'EqualRect', 'GetSystemMenu', 'DispatchMessageA', 'CharNextA', 'CreateBrushIndirect', 'ImageList_Create', 'ImageList_Destroy', 'PeekMessageA', 'UnregisterClassW', 'EnumChildWindows', 'FindFirstFileA', 'SendMessageA', 'GetMessageW', 'MapWindowPoints', 'lstrcmpiW', 'CloseClipboard', 'OutputDebugStringW', 'OpenClipboard', 'SetClipboardData', 'EmptyClipboard', 'GetLocaleInfoA', 'lstrlenA', 'FindFirstFileW', 'LoadLibraryW', 'FindFirstFileExW', 'ImageList_Add', 'VariantChangeType', 'CoGetClassObject', 'ShellExecuteW', 'VariantCopy', 'SysAllocString', 'GetLocalTime', 'MoveWindow', 'lstrlenW', 'RegisterClassExW', 'SysStringLen', 'ClosePrinter', 'SetFileAttributesW', 'AdjustWindowRectEx', 'GetKeyState', 'GetForegroundWindow', 'GetWindowTextLengthW', 'IsIconic', 'GetMenu', 'DestroyMenu', 'GetActiveWindow', 'GetEnvironmentVariableW', 'SetRect', 'LoadTypeLib', 'StretchBlt', 'GetSubMenu', 'GetFullPathNameW', 'SysReAllocStringLen', 'CreatePalette', 'LoadStringA', 'DestroyIcon', 'SaveDC', 'FreeResource', 'CreateDIBSection', 'GetSysColorBrush', 'LineTo', 'WindowFromPoint', 'GetMenuItemCount', 'MoveToEx', 'IsZoomed', 'GetClipBox', 'SetActiveWindow', 'GetWindowDC', 'RestoreDC', 'RegEnumKeyW', 'GetMenuItemID', 'WaitForSingleObjectEx', 'ShellExecuteExW', 'ReadConsoleW', 'FlushInstructionCache', 'InterlockedPushEntrySList', 'SetViewportOrgEx', 'CallNextHookEx', 'UnhookWindowsHookEx', 'OleLockRunning', 'CheckMenuItem', 'SetMenu', 'GetWindowPlacement', 'CoTaskMemRealloc', 'InterlockedExchange', 'CreateBitmap', 'GetCapture', 'GetTopWindow', 'InternetCloseHandle', 'SetThreadLocale', 'SetStretchBltMode', 'CLSIDFromString', 'GetMenuState', 'CreateHalftonePalette', 'GetLastActivePopup', 'GlobalDeleteAtom', 'GetVersionExW', 'DrawIconEx', 'OleCreateFontIndirect', 'SetWindowOrgEx', 'LoadRegTypeLib', 'VarUI4FromStr', 'DeleteMenu', 'CreateMenu', 'RectVisible', 'DrawFrameControl', 'FrameRect', 'InterlockedPopEntrySList', 'SafeArrayGetUBound', 'CreateDIBitmap', 'SafeArrayCreate', 'SafeArrayGetLBound', 'DeleteFileW', 'GetKeyboardLayout', 'GetPixel', 'DrawIcon', 'IsDialogMessageA', 'DrawMenuBar', 'VerQueryValueW', 'GetIconInfo', 'SetParent', 'RemoveMenu', 'SetPixel', 'DestroyCursor', 'SafeArrayPtrOfIndex', 'GetStartupInfoA', 'PatBlt', 'GetKeyboardState', 'InternetOpenW', 'ImageList_Remove', 'EnumThreadWindows', 'ExcludeClipRect', 'GetScrollPos', 'MessageBeep', 'SelectPalette', 'DrawEdge', 'RealizePalette', 'CLSIDFromProgID', 'ImageList_BeginDrag', 'GetScrollRange', 'ImageList_EndDrag', 'ImageList_DragLeave', 'CreatePenIndirect', 'FindResourceExW', 'ImageList_DragMove', 'SetScrollPos', 'ImageList_DragEnter', 'GetBitmapBits', 'GetScrollInfo', 'IntersectClipRect', 'SetScrollInfo', 'SetScrollRange', 'SetWindowPlacement', 'ActivateKeyboardLayout', 'ImageList_GetIconSize', 'SetBrushOrgEx', 'GetSystemPaletteEntries', 'GetCursor', 'GetClipboardData', 'ScrollWindow', 'SHGetFolderPathW', 'DrawFocusRect', 'EnableScrollBar', 'ImageList_ReplaceIcon', 'SetROP2', 'ShowScrollBar', 'ImageList_Draw', 'GetDCEx', 'ShowOwnedPopups', 'VarBstrCat', 'PathAddBackslashW', 'ImageList_GetImageCount', 'GetWindowOrgEx', 'TranslateMDISysAccel', 'ImageList_SetIconSize', 'WaitMessage', 'ImageList_SetBkColor', 'SetDIBColorTable', 'GetPaletteEntries', 'UnrealizeObject', 'CreateIcon', 'ImageList_DrawEx', 'HeapCreate', 'ImageList_DragShowNolock', 'GetKeyboardLayoutList', 'ImageList_Read', 'ImageList_GetBkColor', 'ImageList_Write', 'GetDIBColorTable', 'GetCurrentPositionEx', 'MaskBlt', 'CryptReleaseContext', 'ImageList_GetDragImage', 'GetBrushOrgEx', 'GetMessagePos', 'InternetConnectW', 'PlayEnhMetaFile', 'GetEnhMetaFileHeader', 'CryptAcquireContextW', 'HttpOpenRequestW', 'HttpSendRequestW', 'CreateWindowExA', 'GetFullPathNameA', 'CoCreateGuid', 'DestroyAcceleratorTable', 'InvalidateRgn', 'DeleteEnhMetaFile', 'GetWinMetaFileBits', 'StringFromGUID2', 'SetWinMetaFileBits', 'GetEnhMetaFilePaletteEntries', 'SetEnhMetaFileBits', 'GetEnhMetaFileBits', 'LoadStringW', 'PathAppendW', 'InternetCrackUrlW', 'CryptCreateHash', 'CryptDestroyHash', 'CryptHashData', 'lstrcpynA', 'SetWindowLongA', 'CryptGetHashParam', 'ImageList_Replace', 'GetExitCodeProcess', 'Shell_NotifyIconW', 'SetLayeredWindowAttributes', 'EndPage', 'EndDoc', 'InitCommonControls', 'DefWindowProcA', 'LoadCursorA', 'ImageList_SetImageCount', 'GetProcessId', 'CallWindowProcA', 'StartPage', 'RegisterClassW', 'UrlEscapeW', 'UrlUnescapeW', 'VarBstrCmp', 'GetWindowLongA', 'RemoveDirectoryW', 'AccessibleObjectFromWindow', 'PtInRect', 'SetAbortProc', 'GetDiskFreeSpaceW', 'GlobalSize', 'RegisterClassA', 'lstrcpyA', 'SetWindowTextA', 'GetVersionExA', 'FormatMessageA', 'SystemParametersInfoA', 'DrawTextA', 'ExitThread', 'GetDiskFreeSpaceA', 'OffsetRect', 'CreateFontIndirectA', 'VerQueryValueA', 'LoadBitmapA', 'GetMonitorInfoW', 'GetClassInfoA', 'Pie', 'UnregisterClassA', 'InflateRect', 'MsgWaitForMultipleObjects', 'SystemParametersInfoW', 'GetFileVersionInfoA', 'GetFileVersionInfoSizeA', 'RegEnumValueW', 'SetClassLongA', 'MonitorFromWindow', 'FileTimeToLocalFileTime', 'LoadIconW', 'GetFileVersionInfoSizeW', 'GetFileVersionInfoW', 'ResumeThread', 'GetCurrentThread', 'NetWkstaGetInfo', 'CompareStringA', 'CharUpperW', 'IsRectEmpty', 'FindWindowExW', 'CopyFileA', 'IntersectRect', 'SwitchToThread', 'Rectangle', 'FindResourceA', 'GetPrivateProfileStringA', 'GlobalHandle', 'GetClassInfoW', 'CharPrevA', 'SetFileTime', 'WritePrivateProfileStringA', 'GetKeyboardType', 'GetExitCodeThread', 'CharUpperBuffW', 'SetThreadPriority', 'SetClassLongW', 'GetDlgCtrlID', 'ExitWindowsEx', 'PostMessageA', 'GetDateFormatW', 'CreateEventA', 'GetTempPathW', 'EndDialog', 'CreateRectRgn', 'LoadIconA', 'GetTextExtentPoint32W', 'GetObjectA', 'VerSetConditionMask', 'EnumCalendarInfoW', 'FindWindowW', 'IsEqualGUID', 'GetDateFormatA', 'OleDraw', 'IsDialogMessageW', 'GetPropW', 'Polyline', 'SetPropW', 'VerifyVersionInfoW', 'SetWindowRgn', 'RoundRect', 'FindNextFileA', 'CreateProcessW', 'GetErrorInfo', 'GetWindowTextA', 'GetTimeZoneInformation', '_TrackMouseEvent', 'SuspendThread', 'GetTextMetricsW', 'GetClassNameA', 'SetHandleCount', 'GlobalReAlloc', 'QueryPerformanceFrequency', 'lstrcmpiA', 'Ellipse', 'GdiFlush', 'HideCaret', 'SetWindowsHookExW', 'GetClassLongW', 'SHGetSpecialFolderLocation', 'CopyImage', 'InterlockedCompareExchange', 'ExtTextOutW', 'SetPropA', 'IsClipboardFormatAvailable', 'GetPropA', 'FindWindowA', 'GetMenuItemInfoW', 'GetUserDefaultUILanguage', 'RegisterWindowMessageA', 'RegFlushKey', 'RemovePropW', 'MonitorFromPoint', 'ShowCaret', 'SleepEx', 'GetTextExtentPoint32A', 'RemovePropA', 'GlobalAddAtomA', 'GetRgnBox', 'GetThreadPriority', 'GetSystemDefaultUILanguage', 'CharLowerBuffW', 'MapVirtualKeyW', 'SetWindowsHookExA', 'GlobalAddAtomW', 'SetMenuItemInfoW', 'InsertMenuItemW', 'GetTextMetricsA', 'DeleteFileA', 'RegisterClipboardFormatW', 'TryEnterCriticalSection', 'GetMenuStringW', 'GlobalFindAtomA', 'EnumClipboardFormats', 'SetCursorPos', 'GlobalFindAtomW', 'GetFileAttributesA', 'CharToOemA', 'IsWindowUnicode', 'RegSaveKeyW', 'DrawTextExW', 'GetKeyNameTextW', 'CreateDCW', 'OemToCharA', 'wsprintfA', 'WinHelpA', 'RegisterClipboardFormatA', 'DragFinish', 'InsertMenuW', 'RegSetValueExA', 'ImageList_SetDragCursorImage', 'OpenPrinterW', 'Polygon', 'EnumDisplayMonitors', 'CharLowerW', 'StretchDIBits', 'WaitForMultipleObjectsEx', 'GetMenuItemInfoA', 'EnumResourceNamesW', 'InsertMenuA', 'MapVirtualKeyA', 'InsertMenuItemA', 'CharLowerA', 'GetKeyboardLayoutNameW', 'GetMenuStringA', 'DocumentPropertiesW', 'ImageList_GetIcon', 'VariantCopyInd', 'MsgWaitForMultipleObjectsEx', 'GetDCOrgEx', 'EnumCalendarInfoA', 'SetMenuItemInfoA', 'DefFrameProcA', 'CopyIcon', 'DefMDIChildProcA', 'AngleArc', 'ShowCursor', 'RegConnectRegistryW', 'VirtualQueryEx', 'GetKeyNameTextA', 'SetMapMode', 'EnumFontFamiliesExW', 'FrameRgn', 'GetStringTypeExA', 'FileTimeToDosDateTime', 'StringFromCLSID', 'MonitorFromRect', 'FlatSB_SetScrollProp', 'LoadKeyboardLayoutA', 'FlatSB_SetScrollPos', 'FlatSB_GetScrollPos', 'FlatSB_GetScrollInfo', 'ExtFloodFill', 'InitializeFlatSB', 'FlatSB_SetScrollInfo', 'DefFrameProcW', 'GetComputerNameW', 'RegLoadKeyW', 'DefMDIChildProcW', 'SetDIBits', 'ImageList_GetImageInfo', 'GetMessageExtraInfo', 'CreateDirectoryA', 'Arc', 'OpenProcessToken', 'GetTextExtentPointW', 'LoadKeyboardLayoutW', 'EndMenu', 'CopyEnhMetaFileW', 'GetCPInfoExW', 'PolyBezierTo', 'ImageList_Copy', 'ImageList_LoadImageW', 'ArcTo', 'PolyBezier', 'lstrcmpA', 'Chord', 'GetMessageTime', 'GetEnhMetaFileDescriptionW', 'StartDocW', 'ImageList_SetOverlayImage', 'RegUnLoadKeyW', 'SetEnvironmentVariableA', 'EnumFontsW', 'AbortDoc', 'RegRestoreKeyW', 'RegCreateKeyExA', 'EnumPrintersW', 'CreateICW', 'GetTempPathA', 'RegReplaceKeyW', 'SendDlgItemMessageA', 'GetDefaultPrinterW', 'CharLowerBuffA', 'GetOpenFileNameA', 'BringWindowToTop', 'OpenProcess', 'GetSystemDirectoryW', 'CopyEnhMetaFileA', 'CheckDlgButton', 'CreateProcessA', 'NetApiBufferFree', 'SetRectRgn', 'GetSaveFileNameA', 'DragAcceptFiles', 'lstrcpynW', 'ProgIDFromCLSID', 'VirtualProtectEx', 'ExpandEnvironmentStringsW', 'GetThreadContext', 'OpenPrinterA', 'GetStretchBltMode', 'GetActiveObject', 'LPtoDP', 'CompareFileTime', 'CreateDCA', 'GetAsyncKeyState', 'RemoveDirectoryA', 'TextOutA', 'CloseEnhMetaFile', 'DocumentPropertiesA', 'SetCurrentDirectoryW', 'OleSetMenuDescriptor', 'ShellExecuteA', 'SHGetFolderPathA', 'ImageList_AddMasked', 'GetWindowsDirectoryA', 'IsAccelerator', 'LresultFromObject', 'GetWindowsDirectoryW', 'CreateEnhMetaFileW', 'GetProfileStringA', 'GetTextExtentPointA', 'RegDeleteValueA', 'MoveFileW', 'DragQueryFileA', 'PrintDlgA', 'StartDocA', 'EnumPrintersA', 'CreateICA', 'memcpy', 'GetDCPenColor', 'FindTextA', 'ChooseFontA', 'lstrcatA', 'OleRegEnumVerbs', 'ReplaceTextA', 'PageSetupDlgA', 'RegDeleteKeyA', 'sndPlaySoundW', 'GetProfileIntA', 'WaitForMultipleObjects', 'GetSystemDirectoryA', 'RegEnumKeyA', 'RegEnumValueA', 'AdjustTokenPrivileges', 'SetFileAttributesA', 'GetSystemTime', 'FileTimeToSystemTime', 'SetCurrentDirectoryA', 'ExpandEnvironmentStringsA', 'SHGetPathFromIDListW', 'SafeArrayAccessData', 'SafeArrayUnaccessData', 'ReleaseMutex', 'GetConsoleOutputCP', 'SetErrorInfo', 'UnmapViewOfFile', 'CopyFileW', 'CreateErrorInfo', 'LoadImageW', 'CreateMutexW', 'wsprintfW', 'HeapSetInformation', 'LookupPrivilegeValueW', 'GetTempFileNameA', 'PathFileExistsW', 'SystemTimeToFileTime', 'SHBrowseForFolderW', 'MoveFileA', 'lstrcpyW', 'SetDlgItemTextA', 'CreateFileMappingW', 'MoveFileExW', 'AllocateAndInitializeSid', 'SHGetPathFromIDListA', 'LoadImageA', '_CorExeMain', 'GetShortPathNameA', 'WSAStartup', 'DialogBoxParamA', 'NotifyWinEvent', 'DrawStateW', 'LCMapStringA', 'GetUserNameW', 'GetDlgItemTextA', 'AppendMenuA', 'memset', 'DuplicateHandle', 'SelectClipRgn', 'SHBrowseForFolderA', 'SetDCPenColor', 'GetStringTypeA', 'CreateDialogParamA', 'FindWindowExA', 'SHGetFileInfoA', 'ChildWindowFromPoint', 'SHFileOperationA', 'GetScrollBarInfo', 'SafeArrayPutElement', 'SafeArrayGetElement', 'SHFileOperationW', 'SendMessageTimeoutA', 'SearchPathA', 'GetTempFileNameW', 'NtUnmapViewOfSection', 'MapViewOfFile', 'WSACleanup', 'lstrcatW', 'closesocket', 'MessageBoxIndirectA', 'GetShortPathNameW', 'SHGetFileInfoW', 'DialogBoxParamW', 'GetCurrentDirectoryW', 'AddAce', 'InternetReadFile', 'GetTokenInformation', 'GetUserDefaultLangID', 'WritePrivateProfileStringW', 'InitializeSecurityDescriptor', 'GetPrivateProfileStringW', 'CharPrevW', 'SetEnvironmentVariableW', 'CopySid', 'SetDlgItemTextW', 'FreeEnvironmentStringsA', 'GetEnvironmentStrings', 'CreateToolhelp32Snapshot', 'LookupPrivilegeValueA', 'SysAllocStringByteLen', 'LocalFileTimeToFileTime', 'TerminateThread', 'SetSecurityDescriptorDacl', 'DuplicateTokenEx', 'WSAGetLastError', 'htons', 'socket', 'send', 'AppendMenuW', 'DeregisterEventSource', '__set_app_type', 'SysStringByteLen', 'ReleaseSemaphore', 'SHGetMalloc', 'GetVolumeInformationW', 'CreateDialogParamW', 'DispCallFunc', 'SendMessageTimeoutW', 'CombineRgn', 'DebugBreak', 'exit', 'recv', 'GetDriveTypeW', 'GetDlgItemTextW', 'ioctlsocket', 'IsDlgButtonChecked', 'DeviceIoControl', 'GetAce', 'EqualSid', 'connect', 'setsockopt', 'GetLengthSid', 'FindFirstFileExA', 'WriteConsoleA', 'CreateRoundRectRgn', 'GetFileTime', '__p__fmode', 'timeGetTime', 'LookupPrivilegeNameW', 'CreateProcessAsUserW', 'ConvertToAutoInheritPrivateObjectSecurity', 'InitCommonControlsEx', 'AddAccessAllowedAce', 'Process32NextW', 'GetEnvironmentVariableA', 'Process32FirstW', 'CopyRect', 'GetFileInformationByHandle', '_initterm', 'FreeSid', 'EnumSystemLocalesA', 'AddAccessAllowedObjectAce', '__setusermatherr', '__vbaExceptHandler', 'AccessCheckByTypeResultListAndAuditAlarmW', 'EVENT_SINK_QueryInterface', 'EVENT_SINK_AddRef', 'EVENT_SINK_Release', 'AccessCheckByTypeResultList', 'AccessCheckByTypeAndAuditAlarmW', '_exit', '_allmul', 'AddAccessAllowedAceEx', '_CIsqrt', 'OpenSCManagerW', 'GetConsoleWindow', '_CIsin', 'GetCurrentDirectoryA', 'SearchPathW', '_CIcos', 'DllFunctionCall', '_CIlog', 'CreatePen', 'CloseServiceHandle', 'SignalObjectAndWait', '_CIatan', '_CIexp', 'SHGetSpecialFolderPathW', 'AddAuditAccessAceEx', '_CItan', '_adj_fprem', '_adj_fdivr_m32', '_adj_fptan', '_adj_fprem1', '_adj_fdiv_m32', '_adj_fdivr_m64', '_adj_fdiv_m32i', '_adj_fdivr_m32i', '_adj_fdiv_r', '_adj_fdiv_m64', '_adj_fdivr_m16i', '__vbaChkstk', '__vbaFPException', '_adj_fdiv_m16i', '_adj_fpatan', 'AddAuditAccessAce', 'AccessCheckByTypeResultListAndAuditAlarmA', 'AddAuditAccessObjectAce', '__getmainargs', 'AdjustTokenGroups', 'wvsprintfW', 'CloseEventLog', 'select', '__vbaFreeVar', 'AddAccessDeniedAceEx', 'AddAccessDeniedObjectAce', 'RegisterEventSourceW', 'RegOpenKeyW', '__vbaHresultCheckObj', '__vbaFreeStr', 'GetMenuCheckMarkDimensions', 'GetAclInformation', 'free', 'AccessCheck', 'ntohs', 'CreateMutexA', 'gethostbyname', '__vbaStrMove', 'AreAllAccessesGranted', 'BackupEventLogW', '__vbaNew2', 'AllocateLocallyUniqueId', '__vbaSetSystemError', '_cexit', 'AreAnyAccessesGranted', 'GetWindowModuleFileNameW', 'GetMessageA', 'malloc', '_XcptFilter', '__vbaFreeVarList', 'CoInitializeEx', 'GetTextColor', 'GetUserNameA', 'listen', 'inet_addr', 'TextOutW', '__p__commode', 'IsValidAcl', 'gethostname', 'PostThreadMessageW', 'ReportEventW', '__vbaFreeObj', 'CreateFileMappingA', 'DragQueryFileW', '_onexit', 'ImpersonateLoggedOnUser', 'InitializeAcl', 'MessageBoxIndirectW', 'SendDlgItemMessageW', '__vbaVarMove', 'GetDriveTypeA', 'GetCurrentObject', 'GetNearestPaletteIndex', 'DosDateTimeToFileTime', 'FreeConsole', 'SetFileSecurityA', 'DuplicateToken', 'bind', 'RegEnumKeyExA', 'WinHttpOpen', '_controlfp', 'WinExec', 'GetSecurityDescriptorDacl', 'FindFirstFreeAce', 'GetTimeFormatW', 'LookupAccountSidW']
    pe = pefile.PE(fileLoc)
    res = []
    final = []

    for entry in pe.DIRECTORY_ENTRY_IMPORT:
        for imp in entry.imports:
            res.append(imp.name)   
    for i in allImports:
        if i in res:
            final.append(1)
        else:
            final.append(0)
    stringFinal = ''
    for i in final:
        stringFinal= stringFinal + ',' + str(i)

    #stringFinal = hash + stringFinal
    stringFinal = stringFinal[1:]
    return final

def importsVeredict(fileLocation):
    y = getImports(fileLocation)
    res = [True, 0]
    res[1] = ML2.importsPrediction(y)
    if res[1] >= 0.75:
        res[0] = True #malware
    else: 
        res[0] = False #goodware
    return res

def headersVeredict(fileLocation):
    x = getHeadersInfo(fileLocation)
    res = [True, 0]
    res[1] = ML.headersPrediction(x)
    if res[1] >= 0.5:
        res[0] = True#malware
    else:
        res[0] = False #goodware
    return res

def composeVeredict(fileLocation):
    y = getImports(fileLocation)
    resImp = [True, 0]
    resImp[1] = ML2.importsPrediction(y)

    x = getHeadersInfo(fileLocation)
    resHead = [True, 0]
    resHead[1] = ML.headersPrediction(x)

    endRes = [True, resImp[1], resHead[1]]#boo, imp, head
    if resImp[1] >= 0.75 and resHead[1] >= 0.5: # T T 
        endRes[0] = True
    elif resImp[1] < 0.75 and resHead[1] >= 0.5: # F T
        endRes[0] = False
    elif resImp[1] >= 0.75 and resHead[1] < 0.5: # t F
        endRes[0] = True
    else: 
        endRes[0] = False 
    return endRes
