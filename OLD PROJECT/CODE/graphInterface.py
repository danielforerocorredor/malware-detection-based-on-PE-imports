from tkinter import *
from tkinter import filedialog
import getFileInfo
import ML_for_imports
import ML_for_headers

HEIGTH = 700
WIDTH = 800

root = Tk()
root.title('ANALYSIS OF PE')

canvas = Canvas(root, height=HEIGTH,width = WIDTH, bg= '#007f80')
canvas.pack()

titleLabel = Label(root, text = 'TYPE OF ANALYSIS SELECTION:', bg= '#f14717')
titleLabel.place(relx=0.35,rely = 0.35, relwidth= 0.3, relheight=0.1)


def getFileLoc():
    global Loc 
    Loc = filedialog.askopenfilename(initialdir='/Users/danielforero/Documents',title='select a .exe file', filetypes=(('exe files','*.exe'),('all files', '*.*')))
    return str(Loc)

def headers():
    x = getFileInfo.headersVeredict(getFileLoc())
    singlePopup(x[0], x[1], 'HEADERS')   

def imports():
    x = getFileInfo.importsVeredict(getFileLoc())
    singlePopup(x[0], x[1], 'IMPORTS')   

def both():
    x = getFileInfo.composeVeredict(getFileLoc())
    bothPopup(x[0], x[1], x[2])
    
def bothPopup(B, PrIm, PrHe):
    novi = Toplevel()
    canvas = Canvas(novi, width = 300, height = 200, bg = '#009c9d')
    canvas.pack(expand = YES, fill = BOTH)
    titleLabel = Label(canvas, text = '  |----- ANALYSIS -----|  ', bg= '#f14717')
    titleLabel.place(relx=0.15,rely = 0.1, relwidth= 0.7, relheight=0.2)
    Impmessage = 'Probability of being malware given by imports model: ' + str(PrIm)
    titleLabel2 = Label(canvas, text = Impmessage, bg= '#f14717')
    titleLabel2.place(relx=0.15,rely = 0.3, relwidth= 0.7, relheight=0.2)
    Headmessage = 'Probability of being malware given by headers model: ' + str(PrHe)
    titleLabel3 = Label(canvas, text = Headmessage, bg= '#f14717')
    titleLabel3.place(relx=0.15,rely = 0.5, relwidth= 0.7, relheight=0.2)

    if B == True:
        titleLabel4 = Label(canvas, text = 'compound analysis: MALWARE DETECTED', bg= '#f14717')
        titleLabel4.place(relx=0.15,rely = 0.7, relwidth= 0.7, relheight=0.2)
    else: 
        titleLabel4 = Label(canvas, text = 'compound analysis: GOODWARE DETECTED', bg= '#f14717')
        titleLabel4.place(relx=0.15,rely = 0.7, relwidth= 0.7, relheight=0.2)

def singlePopup(B, P, txt):
    novi = Toplevel()
    canvas = Canvas(novi, width = 300, height = 200, bg = '#009c9d')
    canvas.pack(expand = YES, fill = BOTH)
    titleLabel = Label(canvas, text = '  |----- ANALYSIS -----|  ', bg= '#f14717')
    titleLabel.place(relx=0.15,rely = 0.1, relwidth= 0.7, relheight=0.2)
    if txt == 'HEADERS': 
        message = 'Probability of being malware given by headers model: ' + str(P)
    else:
        message = 'Probability of being malware given by imports model: ' + str(P)

    titleLabel2 = Label(canvas, text = message, bg= '#f14717')
    titleLabel2.place(relx=0.15,rely = 0.3, relwidth= 0.7, relheight=0.2)
    if B == True:
        titleLabel4 = Label(canvas, text = ' final analysis: GOODWARE DETECTED', bg= '#f14717')
        titleLabel4.place(relx=0.15,rely = 0.5, relwidth= 0.7, relheight=0.2)
    else: 
        titleLabel4 = Label(canvas, text = 'final analysis: GOODWARE DETECTED', bg= '#f14717')
        titleLabel4.place(relx=0.15,rely = 0.5, relwidth= 0.7, relheight=0.2)

#                                       FRAME TITULO 

frameTitle = Frame(root, bg = '#009c9d')
frameTitle.place(relx=0.05,rely = 0.1, relwidth= 0.9, relheight=0.2)

titleLabel = Label(frameTitle, text = '  |----- MALWARE DETECTION BASED ON PE INFORMATION -----|  ', bg= '#f14717')
titleLabel.place(relx=0.15,rely = 0.1, relwidth= 0.7, relheight=0.8)

#                                       FRAME BOTONES

frameButtons = Frame(root, bg = '#009c9d')
frameButtons.place(relx=0.05,rely = 0.5, relwidth= 0.9, relheight=0.4)

#BOTON ANALISIS CON HEADERS
headersAnalysisButton = Button(frameButtons, text = 'File analysis based on PEs headers information', command=headers)
headersAnalysisButton.place(relx=0.1,rely = 0.1, relwidth= 0.8, relheight=0.2)

#BOTON ANALISIS CON IMPORTS
importsAnalysisButton = Button(frameButtons, text = 'File analysis based on PEs imports information', command=imports)
importsAnalysisButton.place(relx=0.1,rely = 0.4, relwidth= 0.8, relheight=0.2)

#BOTON ANALISIS COMPUESTO
compoundAnalysisButton = Button(frameButtons, text = 'File analysis based on PEs headers and imports information', command = both)
compoundAnalysisButton.place(relx=0.1,rely = 0.7, relwidth= 0.8, relheight=0.2)


root.mainloop()

